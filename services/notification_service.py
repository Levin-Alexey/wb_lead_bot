# services/notification_service.py
import re
from typing import Dict, Any
from telegram import InlineKeyboardButton, InlineKeyboardMarkup
from telegram.constants import ParseMode

def format_notification_text_html(text: str) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∑–∞–º–µ–Ω—è—è —Ç–µ–∫—Å—Ç –≤ –∑–≤–µ–∑–¥–æ—á–∫–∞—Ö –Ω–∞ –∂–∏—Ä–Ω—ã–π HTML
    """
    # –ó–∞–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É * –Ω–∞ <b>—Ç–µ–∫—Å—Ç</b>
    formatted_text = re.sub(r'\*(.*?)\*', r'<b>\1</b>', text)
    return formatted_text

def get_24h_notification_text() -> str:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞ —Å HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    """
    text = """*–¢—ã —É–∂–µ –∑–∞–¥—É–º—ã–≤–∞–ª—Å—è –æ —Ä–∞–±–æ—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞—Ö ‚Äî –∏, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫.*
–í–æ–∑–º–æ–∂–Ω–æ, —Ö–æ—á–µ—à—å –≤—ã–±—Ä–∞—Ç—å—Å—è –∏–∑ –Ω–∞–π–º–∞. –ò–ª–∏ –Ω–∞–π—Ç–∏ —É–¥–∞–ª—ë–Ω–Ω—ã–π –¥–æ—Ö–æ–¥, —á—Ç–æ–±—ã –±—ã—Ç—å —Å–≤–æ–±–æ–¥–Ω–µ–µ –≤ –¥–µ–Ω—å–≥–∞—Ö –∏ –º–µ—Å—Ç–µ –∂–∏—Ç–µ–ª—å—Å—Ç–≤–∞. –ù–æ, –∫–∞–∫ –∏ —É –º–Ω–æ–≥–∏—Ö, –≤–Ω—É—Ç—Ä–∏ —Å–∏–¥–∏—Ç —Å—Ç—Ä–∞—Ö: *–∞ –≤–¥—Ä—É–≥ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è?* –í–¥—Ä—É–≥ —Å–æ–ª—å—é –¥–µ–Ω—å–≥–∏? –í–¥—Ä—É–≥ –≤—Å—ë –æ–∫–∞–∂–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ?
–ò –≤–æ—Ç –≤ —Ç–∞–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –∫–∞–∫ —Ä–∞–∑ –∏ –Ω—É–∂–µ–Ω *–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ*, –≥–¥–µ —Ç–µ–±—è –Ω–µ –±—Ä–æ—Å—è—Ç —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ –æ–¥–∏–Ω–æ—á–∫—É.
üí¨ –í MarketSkills –º—ã —Å–æ–±—Ä–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–æ–≥–∞–µ—Ç –∑–∞–π—Ç–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã –¥–∞–∂–µ —Å –Ω—É–ª—è ‚Äî –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π, –±–µ–∑ ¬´–∏–Ω—Ñ–æ—Ü—ã–≥–∞–Ω—Å—Ç–≤–∞¬ª, —Å –∂–∏–≤—ã–º–∏ –∫–µ–π—Å–∞–º–∏ –∏ —Ä–µ–∞–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑—å—é.
–¢—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫—É–ø–∞–µ—à—å –ø–æ–¥–ø–∏—Å–∫—É.
 –¢—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è —á–∞—Å—Ç—å—é –∫–æ–º—å—é–Ω–∏—Ç–∏, –≥–¥–µ:
 ‚Äî —Ç–µ–±—è –æ–±—É—á–∞—é—Ç –ø—Ä–∞–∫—Ç–∏–∫–∏;
 ‚Äî –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤, —Å –∫–µ–º –æ—Ç–∫—Ä—ã—Ç—å –±–∏–∑–Ω–µ—Å;
 ‚Äî –∞ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ ‚Äî –¥–∞–∂–µ —É—Å—Ç—Ä–æ–∏—Ç—å—Å—è –≤ –∫–æ–º–∞–Ω–¥—É –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–µ–∑ —Å–≤–æ–∏—Ö –≤–ª–æ–∂–µ–Ω–∏–π.
üöÄ–í—Å—ë —ç—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ —á–∞—Ç–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–ø—É—Å–∫–æ–≤.
–ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–±—è –¥–æ —Å–∏—Ö –ø–æ—Ä –µ—Å—Ç—å –æ—Ç–∫–ª–∏–∫ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è.
üëá –ö–Ω–æ–ø–∫–∞ –Ω–∏–∂–µ ‚Äî –∏ —Ç—ã —Å –Ω–∞–º–∏:"""
    
    return format_notification_text_html(text)

def get_24h_notification_photo_path() -> str:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Ç—å –∫ –∫–∞—Ä—Ç–∏–Ω–∫–µ –¥–ª—è 24-—á–∞—Å–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    """
    return "content/p24.jpg"

def get_24h_notification_keyboard() -> InlineKeyboardMarkup:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
    """
    keyboard = [[InlineKeyboardButton("–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è", callback_data='notification_24h_connect')]]
    return InlineKeyboardMarkup(keyboard)

def get_48h_notification_text() -> str:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ 48 —á–∞—Å–æ–≤
    """
    text = """*–ß–¢–û –£ –ù–ê–° –ü–†–û–ò–ó–û–®–õ–û –ó–ê –ü–û–°–õ–ï–î–ù–ò–ï 2 –ù–ï–î–ï–õ–ò –í MARKETSKILLS:*
üí• –ö –Ω–∞–º –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å —É–∂–µ *100+ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤*, –∏ —Å –∫–∞–∂–¥—ã–º –¥–Ω—ë–º –∫–æ–º—å—é–Ω–∏—Ç–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–∏–ª—å–Ω–µ–µ ‚Äî —Ä–µ–±—è—Ç–∞ –∑–∞–ø—É—Å–∫–∞—é—Ç –º–∞–≥–∞–∑–∏–Ω—ã, —Ä–∞–±–æ—Ç–∞—é, –¥–µ–ª—è—Ç—Å—è —Ñ–∏—à–∫–∞–º–∏, –ø–æ–º–æ–≥–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É –∏ —Ä–∞—Å—Ç—É—Ç –≤–º–µ—Å—Ç–µ.
üì¶ –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ *–æ—Ç–∫—Ä—ã–ª–∏ —Å–≤–æ–∏ –ø–µ—Ä–≤—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã* –ø–æ –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–æ–π –º–æ–¥–µ–ª–∏ ‚Äî –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π, –±–µ–∑ –æ–ø—ã—Ç–∞, –Ω–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π.
üìä –ü—Ä–æ–≤–µ–ª–∏ *–∑–∞–∫—Ä—ã—Ç—ã–π —Ä–∞–∑–±–æ—Ä –Ω–∏—à–∏*, –≥–¥–µ –ø–æ–∫–∞–∑–∞–ª–∏, –∫–∞–∫ –Ω–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä —Å –º–∞—Ä–∂–æ–π –æ—Ç 1000‚ÇΩ –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–µ–π –Ω–∏–∂–µ 3–∫ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤. –¢–∞–∫–∏–µ —à—Ç—É–∫–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫ –Ω–µ –Ω–∞–π—Ç–∏.
üõ† –í–Ω–µ–¥—Ä–∏–ª–∏ *–Ω–æ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã –≤ –∫–∞–Ω–∞–ª–µ* ‚Äî —Ç–µ–ø–µ—Ä—å –≤—Å—ë —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ: –æ–±—É—á–µ–Ω–∏–µ, —à–∞–±–ª–æ–Ω—ã, –≥–æ—Ç–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã, –ø–æ–¥–¥–µ—Ä–∂–∫–∞.
üß† –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞–±–æ—Ç—É —Å *–Ω–µ–π—Ä–æ—Å–µ—Ç—è–º–∏*, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–∂–∞ –Ω–∞ –¥–∏–≤–∞–Ω–µ —Å –ø–æ–º–æ—â—å—é –¥–≤—É—Ö –Ω–∞–∂–∞—Ç–∏–π –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–Ω–æ–≥–æ—á–∞—Å–æ–≤—ã–µ —Ä–∞–±–æ—Ç—ã –∏ –ø–æ–ª—É—á–∞—Ç—å –¥–µ–Ω—å–≥–∏
üéô –ê –µ—â—ë –≤—ã—Ö–æ–¥–∏—Ç *–ø–æ–¥–∫–∞—Å—Ç –≤–Ω—É—Ç—Ä–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞* ‚Äî –¥–µ–ª–∏–º—Å—è –º—ã—Å–ª—è–º–∏, –∫–µ–π—Å–∞–º–∏ –∏ –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã. –ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤.
üìå –ò –¥–∞, *—Ç—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏–ª* ‚Äî –≤—Å—ë –≤ –∑–∞–ø–∏—Å–∏, –º–æ–∂–µ—à—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –∏ –Ω–∞—á–∞—Ç—å —Å —É–¥–æ–±–Ω–æ–π —Ç–æ—á–∫–∏.
–≠—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ.
*–•–æ—á–µ—à—å –±—ã—Ç—å –Ω–µ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–º, –∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–º?*
 –ñ–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –∏ –∑–∞—Ö–æ–¥–∏ ‚Äî –º—ã —Ç–µ–±—è –∂–¥—ë–ºüëá"""
    
    return format_notification_text_html(text)

def get_48h_notification_photo_path() -> str:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Ç—å –∫ –∫–∞—Ä—Ç–∏–Ω–∫–µ –¥–ª—è 48-—á–∞—Å–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    """
    return "content/p48.jpg"

def get_48h_notification_keyboard() -> InlineKeyboardMarkup:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ 48 —á–∞—Å–æ–≤
    """
    keyboard = [[InlineKeyboardButton("–í—Å—Ç—É–ø–∏—Ç—å –≤ –∫–æ–º–∞–Ω–¥—É!", callback_data='notification_48h_connect')]]
    return InlineKeyboardMarkup(keyboard)